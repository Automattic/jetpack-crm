/*! For license information please see ZeroBSCRM.admin.invoicebuilder.min.js.LICENSE.txt */
(()=>{var i={};const e=!1;function zbscrm_JS_draw_invoice_actions_html(i){if(html="",html+='<div id="zbs_invoice_actions">',html+='<div class="zbs-invoice-status">',html+='<span class="'+i.invoiceObj.status+' statty">'+i.invoiceObj.status+"</span>",html+="</div>",!i.invoiceObj.new_invoice&&(i.invoiceObj.portal_installed&&(html+='<a href="'+i.invoiceObj.preview_link+'" target="_blank" class="ui button blue" id="zbs_invoice_preview">'+zbscrm_JS_invoice_lang("preview")+"</a>"),i.invoiceObj.pdf_installed&&(html+='<button id="zbs_invoicing_download_pdf" type="button" class="ui button olive">'+zbscrm_JS_invoice_lang("dl_pdf")+"</button>",Formhtml='<form target="_blank" method="post" id="zbs_invoicing_download_pdf_form" action="">',Formhtml+='<input type="hidden" name="zbs_invoicing_download_pdf" value="1" />',Formhtml+='<input type="hidden" name="zbs_invoice_id" value="'+i.invoiceObj.id+'" />',Formhtml+="</form>",jQuery("#wpbody").append(Formhtml)),void 0!==window.zbsJS_invEmailActive&&1==window.zbsJS_invEmailActive)){const i=zbscrmJS_retrieveCurrentBillToEmail();void 0!==i&&""!=i&&zbscrm_JS_validateEmail(i)&&(html+='<button type="button" id="zbs_invoicing_send_email" class="ui button yellow">'+zbscrm_JS_invoice_lang("send_email")+"</button>")}return i.invoiceObj.new_invoice&&(html+='<input type="hidden" name="zbscrm_newinvoice" value="1" />'),html+="</div>",html}function zbscrmJS_retrieveCurrentBillToEmail(){let i=jQuery("#zbs_inv_bill").val();if(void 0===i||!zbscrm_JS_validateEmail(i)){let e=window.zbs_invoice.invoiceObj.bill;null!=e&&""!=e||void 0===window.zbsJS_prefillemail||void 0===window.zbsJS_prefillid||(e=window.zbsJS_prefillemail),i=e}return i}function zbscrm_JS_draw_invoice_top_right_form(i){if(html="",html+='<div class="zbs-invoice-topper">',html+='<table class="form-table">',"1"!=i.invoiceObj.settings.hideid){let e="",t=-1;void 0!==i.invoiceObj.id&&(e=i.invoiceObj.id,t=i.invoiceObj.id),-1==e?(html+='<tr class="hide"><th></th><td>',html+='<input type="hidden" name="zbsinvid" value="'+t+'" />',html+="</td></tr>"):(html+='<tr class="wh-large zbs-invoice-number"><th><label for="no">'+zbscrm_JS_invoice_lang("invoice_number")+":</label></th>",html+="<td>",html+='<span class="zbs-inv-no">'+e+"</span>",html+='<input type="hidden" name="zbsinvid" value="'+t+'" />',html+="</td>",html+="</tr>")}return html+='<tr class="wh-large"><th><label for="date">'+zbscrm_JS_invoice_lang("invoice_date")+":</label></th>",html+="<td>",html+='<input type="date" name="zbsi_date" placeholder="yyyy-mm-dd" value="'+i.invoiceObj.date_date+'" />',html+="</td>",html+="</tr>",html+='<tr class="wh-large">',html+='<th><label for="ref">'+zbscrm_JS_invoice_lang("reference")+":</label></th>",html+="<td>","reftype"in i.invoiceObj.settings&&"autonumber"===i.invoiceObj.settings.reftype?"draft"===i.invoiceObj.status?(prefix=i.invoiceObj.settings.refprefix,next_number=i.invoiceObj.settings.refnextnum,suffix=i.invoiceObj.settings.refsuffix,is_first_invoice=i.invoiceObj.settings.isfirstinv,html+='<span style="color:grey" title="'+zbscrm_JS_invoice_lang("nextref")+'">'+zbscrm_JS_invoice_lang("autogenerated")+": "+prefix+next_number+suffix+"</span>",is_first_invoice&&""===prefix&&""===suffix&&(html+='<br><a href="'+i.invoiceObj.settings.settings_slug+'"> '+zbscrm_JS_invoice_lang("refsettings")+"</a>")):html+='<span class="zbs-inv-ref">'+i.invoiceObj.id_override+"</span>":html+='<input type="text" name="zbsi_ref" id="ref" class="form-control widetext" placeholder="" value="'+jpcrm.esc_attr(i.invoiceObj.id_override)+'" autocomplete="zbsinv" />',html+="</td>",html+="</tr>",void 0!==i.invoiceObj.due_date&&null!=i.invoiceObj.due_date&&0!=i.invoiceObj.due_date?(html+='<tr class="wh-large"><th><label for="due_date">'+zbscrm_JS_invoice_lang("due_date")+":</label></th>",html+="<td>",html+='<input type="date" name="zbsi_due_date" placeholder="yyyy-mm-dd" value="'+i.invoiceObj.due_date_date+'" />',html+="</td>",html+="</tr>"):(html+='<tr class="wh-large">',html+='<th><label for="due">'+zbscrm_JS_invoice_lang("due_date")+":</label></th>",html+="<td>",html+='<select id="zbsinv_due_days" name="zbsi_due" class="form-control" style="font-size:16px;">',html+='<option value = "-1">'+zbscrm_JS_invoice_lang("due","","none")+"</option>",html+='<option value = "0">'+zbscrm_JS_invoice_lang("due","","on")+"</option>",html+='<option value = "10">'+zbscrm_JS_invoice_lang("due","","ten")+"</option>",html+='<option value = "15">'+zbscrm_JS_invoice_lang("due","","fifteen")+"</option>",html+='<option value = "30">'+zbscrm_JS_invoice_lang("due","","thirty")+"</option>",html+='<option value = "45">'+zbscrm_JS_invoice_lang("due","","fortyfive")+"</option>",html+='<option value = "60">'+zbscrm_JS_invoice_lang("due","","sixty")+"</option>",html+='<option value = "90">'+zbscrm_JS_invoice_lang("due","","ninety")+"</option>",html+="</select>",html+="</td>",html+="</tr>"),"function"==typeof window.zbscrm_JS_draw_invoice_pro_top_right&&(html+=zbscrm_JS_draw_invoice_pro_top_right(i.invoiceObj)),void 0!==window.zbscrmjs_invoice_custom_fields&&window.zbscrmjs_invoice_custom_fields.length,html+="</table></div>",html+='<div class="clear"></div>',html}function zbscrm_JS_draw_customise(i){return html="",html+='<div id="zbs-invoice-customiser">',html+='<div class="ui grid" style="margin: 0em 0.5em;">',html+='<div class="eight wide column" style="padding:0">',html+='<span class="header" style="float:left;">'+zbscrm_JS_invoice_lang("customise")+"</span>",html+='<select class="form-control" id="invoice-customiser-type" name="invoice-customiser-type" id="invoice-customiser-type" style="width:30%;">',html+='<option value="quantity"',"quantity"==i.invoiceObj.invoice_hours_or_quantity&&(html+=' selected="selected"'),html+=">"+zbscrm_JS_invoice_lang("quantity")+"</option>",html+='<option value="hours"',"hours"==i.invoiceObj.invoice_hours_or_quantity&&(html+=' selected="selected"'),html+=">"+zbscrm_JS_invoice_lang("hours")+"</option>",html+="</select>",html+="</div>",html+="</div>",html+="</div>",html+='<div class="clear"></div>',html}function zbscrm_JS_draw_invoice_biz_info(i){return html="",html+='<div id="zbs-business-info-wrapper">',html+='<div class="business-info-toggle">',html+='<i class="fa fa-chevron-circle-right" aria-hidden="true"></i> <span class="your-info-biz">'+zbscrm_JS_invoice_lang("biz_info")+"</span>",html+="</div>",html+='<div class="business-info">',html+='<table class="table zbs-table">',html+="<tbody>",html+="<tr><td>"+i.invoiceObj.settings.bizname+"</td></tr>",html+="<tr><td>"+i.invoiceObj.settings.yourname+"</td></tr>",html+="<tr><td>"+i.invoiceObj.settings.businessextra+"</td></tr>",html+='<tr class="top-pad"><td>'+i.invoiceObj.settings.businessyouremail+"</td></tr>",html+="<tr><td>"+i.invoiceObj.settings.businessyoururl+"</td></tr>",html+="</tbody>",html+="</table>",html+='<span class="edit-or-add"><a href="'+i.invoiceObj.settings.biz_settings_slug+'" target="_blank">'+zbscrm_JS_invoice_lang("add_edit")+"</a></span>",html+="</div>",html+="</div>",html}function zbscrm_JS_generate_invoice_row(i,e,t){let n='<tr class="zbs-invoice-row zbs-item-block zbs-rowid'+e+'" data-rowid="'+e+'">';return null==t.title?item_title="":item_title=t.title,null==t.desc?item_description="":item_description=t.desc,n+='<td class="first">',n+='<input class="form-control zbs-item-name" type="text" name = "zbsli_itemname[]" value = "'+item_title+'" placeholder="'+zbscrm_JS_invoice_lang("rowtitleplaceholder")+'" /><br/>',n+='<textarea class="form-control" name = "zbsli_itemdes[]" placeholder="'+zbscrm_JS_invoice_lang("rowdescplaceholder")+'">'+item_description+"</textarea>",n+="</td>",n+='<td class="second">',n+='<input type="number" class="zbsli_quan zbsli_quan'+e+' form-control quan" data-zbsr="'+e+'" name = "zbsli_quan[]" value = "'+t.quantity+'" min="0">',n+="</td>",n+='<td class="third">',n+='<input type="number" class="zbsli_price zbsli_price'+e+' form-controm price" data-zbsr="'+e+'" name = "zbsli_price[]" value = "'+t.price+'" step="0.01">',n+="</td>",1==i.invoiceObj.settings.invtax&&(n+='<td class="forth">',n+=zbscrm_JS_output_tax_line(i,e,t),n+="</td>"),n+='<td class="fifth row-amount row-amount-'+e+'">',n+="</td>",n+='<td><div class="remove-row" data-rowid="'+e+'"><i class="times circle icon"></i></div></td>',n+="</tr>",window.zbs_invoice_rownum++,n}function zbscrm_JS_output_tax_line(i,e,t){let n;return n=void 0===t.taxes||null==t.taxes?0:parseInt(t.taxes),taxhtml=-1==e?'<select name="zbsli_tax_ship" class="tax-select tax-select'+e+' form-control" data-zbsr="'+e+'">':'<select name="zbsli_tax[]" class="tax-select tax-select'+e+' form-control" data-zbsr="'+e+'">',selected="",0==n&&(selected="selected"),taxhtml+='<option value="0" '+selected+">"+zbscrm_JS_invoice_lang("no_tax")+'</option><optgroup label="'+zbscrm_JS_invoice_lang("taxgrouplabel")+'">',jQuery.each(i.tax_linesObj,(function(i,e){n==e.id?selected="selected":selected="",taxhtml+='<option value="'+e.id+'" '+selected+">"+e.name+" : "+e.rate+"%</option>"})),taxhtml+="</optgroup>",taxhtml+="</select>",taxhtml}function zbscrm_JS_add_empty_row(){let i="";const e={title:"",desc:"",quantity:1,price:0,rate:0};i+=zbscrm_JS_generate_invoice_row(window.zbs_invoice,window.zbs_invoice_rownum,e),jQuery(".zbs-invoice-line-items").append(i),zbscrm_JS_bind_row_actions()}function zbscrm_JS_bind_row_actions(){jQuery("#zbs-add-new-row").off("click").on("click",(function(){zbscrm_JS_add_empty_row(window.zbs_invoice)})),jQuery(".remove-row").off("click").on("click",(function(i){const e=jQuery(this).data("rowid");jQuery(".zbs-rowid"+e).remove(),setTimeout((function(){0==jQuery(".zbs-invoice-row").length&&zbscrm_JS_add_empty_row(window.zbs_invoice)}),0),zbscrm_JS_calcTotals()})),jQuery(".zbs-item-block input[type=number]").on("keyup mouseup",(function(){const i=jQuery(this).data("zbsr");jQuery(this).hasClass("quan")&&(quan=jQuery(this).val()),jQuery(this).hasClass("price")&&(price=jQuery(this).val()),jQuery(this).parent().siblings().find("input[type=number]").each((function(i,e){jQuery(e).hasClass("quan")&&(quan=e.value),jQuery(e).hasClass("price")&&(price=e.value)})),row_tot=quan*price,jQuery(this).parent().siblings(".row-amount-"+i).html(row_tot.toFixed(zbs_root.currencyOptions.noOfDecimals)),zbscrm_JS_calcTotals()})),jQuery(".tax-select").on("change",(function(){jQuery(this).val();zbscrm_JS_calcTotals()}))}function zbscrm_JS_calculate_invoice_subtotal(){let i=0;jQuery(".row-amount").each((function(e,t){let n=jQuery(this).html();""==n&&(n=0),n=parseFloat(n),i+=n})),jQuery("#subtotal-value").html(i.toFixed(zbs_root.currencyOptions.noOfDecimals))}function zbscrm_JS_calculate_invoice_tax_table(){const i=[],e=[],t=[];let n=0,o=-1,a=-1;jQuery(".tax-select").each((function(s,c){if(o=jQuery(this).val(),a=jQuery(this).data("zbsr"),-1==a)i[s]=jQuery(".zbsli_price"+a).val(),t[s]=1;else{const e=parseFloat(jQuery(".zbsli_quan"+a).val()),n=parseFloat(jQuery(".zbsli_price"+a).val());isNaN(e)||isNaN(n)?i[s]=0:i[s]=e*n,t[s]=0}n+=i[s],o>0?(this_tax_line_data=zbscrm_JS_pickTaxRate(o),e[s]=this_tax_line_data.id):e[s]=0})),function(i,e,t){let n=parseFloat(jQuery("#discount-value").html());isNaN(n)&&(n=0);total=parseFloat(jQuery("#subtotal-value").html()),tax_amount=new Array,tax_id=new Array,tax_rate=new Array,n>0&&0!==total?discount_proportion=n/total:discount_proportion=0;for(var o=0;o<i.length;o++)if(1===t[o]||0===total?discount_proportion=0:discount_proportion=n/total,0==e[o])tax_amount[o]=0,tax_id[o]=0;else{const t=zbscrm_JS_pickTaxRate(e[o]),n=parseFloat(t.rate);tax_amount[o]=(1-discount_proportion)*i[o]*n/100,tax_id[o]=e[o]}const a=new Object;for(o=0;o<i.length;o++)a[tax_id[o]]=0;for(o=0;o<i.length;o++)a[tax_id[o]]=a[tax_id[o]]+tax_amount[o];let s="";jQuery.each(a,(function(i,e){if(i>0){const e=zbscrm_JS_pickTaxRate(i);s+='<div class="total-row row">',s+='<div class="tax-name third zlabel">'+e.name+"</div>",s+='<div class="tax-rate third ri">('+e.rate+"%)</div>",s+='<div class="tax-amt zbs-total-tax third ri">'+a[i].toFixed(zbs_root.currencyOptions.noOfDecimals)+"</div>",s+="</div>"}})),jQuery("#tax-total-block").html(s)}(i,e,t)}function zbscrm_JS_pickTaxRate(i){let e=!1;return jQuery.each(window.zbs_invoice.tax_linesObj,(function(t,n){void 0!==n.id&&n.id==i&&(e=n)})),e}function zbscrm_JS_calc_grandtotal(){let i=0;i+=parseFloat(jQuery("#subtotal-value").html()),1==window.zbs_invoice.invoiceObj.settings.invdis&&(i-=parseFloat(jQuery("#discount-value").html())),1==window.zbs_invoice.invoiceObj.settings.invpandp&&(i+=parseFloat(jQuery("#invoice_postage_total").val())),1==window.zbs_invoice.invoiceObj.settings.invtax&&jQuery(".zbs-total-tax").each((function(e,t){const n=parseFloat(jQuery(this).html());isNaN(n)||(i+=n)})),jQuery("#zbs-inv-grand-total").html(i.toFixed(zbs_root.currencyOptions.noOfDecimals)),jQuery("#zbs-inv-grand-total-store").val(i.toFixed(zbs_root.currencyOptions.noOfDecimals)),window.invoice_partial&&(amount_due=parseFloat(jQuery("#zbs-inv-grand-total").html()),jQuery(".partial-row").each((function(i,e){let t=jQuery(".zbs-partial-value",e).text(),n=1;-1!==t.indexOf("(")&&(t=t.replace("(","").replace(")",""),n=-1),t=parseFloat(t)*n,amount_due-=t})),jQuery("#inv-amount-due").html(amount_due.toFixed(zbs_root.currencyOptions.noOfDecimals)))}function zeroBSCRMJS_showContactLinkIf(i){if(jQuery("#zbs-invoice-learn-nav .zbs-invoice-quicknav-contact").remove(),null!=i&&""!==i&&(i=parseInt(i))>0){const e='<a target="_blank" style="margin-left:6px;" class="zbs-invoice-quicknav-contact ui icon button blue mini labeled" href="'+window.zbs_invoice.invoiceObj.settings.contacturlprefix+i+'"><i class="user icon"></i> '+zbscrm_JS_invoice_lang("contact")+"</a>";jQuery("#zbs-invoice-learn-nav").prepend(e)}}function zeroBSCRMJS_showCompanyLinkIf(i){if(jQuery("#zbs-invoice-learn-nav .zbs-invoice-quicknav-company").remove(),null!=i&&""!==i&&(i=parseInt(i))>0){const e='<a target="_blank" style="margin-left:6px;" class="zbs-invoice-quicknav-company ui icon button blue mini labeled" href="'+window.zbs_invoice.invoiceObj.settings.companyurlprefix+i+'"><i class="building icon"></i> '+zbscrm_JS_invoice_lang("company")+"</a>";jQuery("#zbs-invoice-learn-nav").prepend(e)}}function zbscrm_JS_calcTotals(){zbscrm_JS_calculate_invoice_subtotal(),function(){const i=jQuery("#invoice_discount_total").val(),e=jQuery("#invoice_discount_type").val();if(""!=i)if("m"==e)jQuery("#invoice_discount_total_value").val(parseFloat(i).toFixed(zbs_root.currencyOptions.noOfDecimals)),jQuery("#discount-value").html(parseFloat(i).toFixed(zbs_root.currencyOptions.noOfDecimals));else{const e=parseFloat(jQuery("#subtotal-value").html())*i/100;jQuery("#invoice_discount_total_value").val(parseFloat(e).toFixed(zbs_root.currencyOptions.noOfDecimals)),jQuery("#discount-value").html(parseFloat(e).toFixed(zbs_root.currencyOptions.noOfDecimals))}}(),zbscrm_JS_calculate_invoice_tax_table(),zbscrm_JS_calc_grandtotal()}function zbscrm_JS_invoice_lang(i,e,t){if(void 0===e)e="";if(void 0!==window.zbs_invoice.invoiceObj.settings.lang[i]){if(void 0===t)return window.zbs_invoice.invoiceObj.settings.lang[i];if(void 0!==window.zbs_invoice.invoiceObj.settings.lang[i][t])return window.zbs_invoice.invoiceObj.settings.lang[i][t]}return e}jQuery((function(){jQuery(".handlediv").remove(),jQuery(".ui-sortable-handle").remove(),jQuery(".hndle").css("cursor","default"),invoice_id=jQuery(".zbs_invoice_html_canvas").data("invid"),function(i){const t={action:"zbs_get_invoice_data",sec:window.zbscrmjs_secToken,invid:i};jQuery.ajax({type:"POST",url:ajaxurl,data:t,dataType:"json",timeout:2e4,success:function(i){void 0!==i&&(window.zbs_invoice=i),void 0!==i.tax_linesObj&&(window.zbs_tax_table=i.tax_linesObj),void 0!==i.invoiceObj&&void 0!==i.invoiceObj.settings&&void 0!==i.invoiceObj.settings.invtax&&(window.zbs_tax=i.invoiceObj.settings.invtax),function(){if(void 0!==window.zbs_invoice&&!1!==window.zbs_invoice){jQuery("#zbsCantLoadDataSingle").hide(),jQuery("#zbs-edit-wrap, #zbs-screen-options").show(),jQuery("#zbs_loader, #zbs_invoice").show();let i="";i=zbscrm_JS_draw_invoice_actions_html(window.zbs_invoice),i+='<div id="zbs_top_wrapper">',i+=function(i){let e="",t="",n="";""!=i.invoiceObj.logo_url&&(t="hide",n="show");return e='<div id="zbs_invoice_logos">',e+='<div class="wh-logo '+t+'">',e+='<i class="fa fa-file-image-o" aria-hidden="true"></i><span class="wh-logo-text">+ '+zbscrm_JS_invoice_lang("add_logo")+"</span>",e+="</div>",e+='<div class="wh-logo-set '+n+'">',e+='<img id="wh-logo-set-img" src="'+jpcrm.esc_attr(i.invoiceObj.logo_url)+'" />',e+='<input type="hidden" name="zbsi_logo" id="logo" value="'+jpcrm.esc_attr(i.invoiceObj.logo_url)+'" />',e+='<div class="zbs-logo-options">',e+='<span class="zbs-update">'+zbscrm_JS_invoice_lang("update")+"</span>",e+='<span class="zbs-remove"> '+zbscrm_JS_invoice_lang("remove")+"</span>",e+="</div>",e+="</div>",e+="</div>",e}(window.zbs_invoice),i+=zbscrm_JS_draw_invoice_top_right_form(window.zbs_invoice),i+="</div>",i+='<div style="clear:both">&nbsp;</div><div id="zbs_sub_wrapper" class="ui grid">',i+='<div class="six wide column">',i+=zbscrm_JS_draw_invoice_biz_info(window.zbs_invoice),i+="</div>",i+='<div class="ten wide column">',i+=function(i){let t=i.invoiceObj.invoice_contact,n=i.invoiceObj.invoice_company;"object"==typeof e.invoiceObj.invoice_contact&&void 0!==e.invoiceObj.invoice_contact.id&&(t=parseInt(e.invoiceObj.invoice_contact.id));"object"==typeof e.invoiceObj.invoice_company&&void 0!==e.invoiceObj.invoice_company.id&&(n=parseInt(e.invoiceObj.invoice_company.id));let o=i.invoiceObj.bill_name;null!=o&&""!=o||void 0===window.zbsJS_prefillemail||void 0===window.zbsJS_prefillid||(o=window.zbsJS_prefillname,void 0!==window.zbsJS_prefillobjtype&&(1==window.zbsJS_prefillobjtype&&-1==t&&(t=parseInt(window.zbsJS_prefillid)),2==window.zbsJS_prefillobjtype&&-1==n&&(n=parseInt(window.zbsJS_prefillid)),t<=0&&(t=-1),n<=0&&(n=-1)));let a="";return a+='<div id="billing-to">',a+='<div class="billing-to-title">',a+='<i class="linkify icon"></i> <span class="your-info-biz">'+zbscrm_JS_invoice_lang("send_to")+"</span>",a+="</div>",a+='<div class="form-table">',a+='<div class="wh-large inv-to-input">',a+='<div class="zbs-type-ahead-invoice">',a+='<input class="form-control typeahead" type="text" id="zbs_inv_bill" name="zbscq_bill" value="'+o+'" placeholder="'+zbscrm_JS_invoice_lang("bill_to")+'" />',a+="</div>",a+='<div class="edit-c"><a class="zbs-edit-assign-to" href="#">'+zbscrm_JS_invoice_lang("edit_record")+"</a></div>",a+="</div>",a+="</div>",a+="</div>",a+='<div class="clear"></div>',a+='<input type="hidden" id="zbs_invoice_contact" name="zbs_invoice_contact" value="'+t+'" />',a+='<input type="hidden" id="zbs_invoice_company" name="zbs_invoice_company" value="'+n+'" />',a}(window.zbs_invoice),i+="</div>",i+="</div>",i+=zbscrm_JS_draw_customise(window.zbs_invoice),i+=function(i){window.zbs_invoice_rownum=1;let e="";"function"==typeof window.zbscrm_JS_draw_invoiceCustomiserExtras&&(e+='<div class="clear" style="position:relative;margin:10px;height:40px">',e+=zbscrm_JS_draw_invoiceCustomiserExtras(i),e+="</div>");e+='<div id="zbs-invoice-items">',e+='<table class="table">',e+="<thead>",e+="<th>"+zbscrm_JS_invoice_lang("description")+"</th>","quantity"==i.invoiceObj.invoice_hours_or_quantity?(e+='<th class="cen" id="zbs_inv_qoh">'+zbscrm_JS_invoice_lang("quantity")+"</th>",e+='<th class="cen" id = "zbs_inv_por" >'+zbscrm_JS_invoice_lang("price")+"</th>"):(e+='<th class="cen" id="zbs_inv_qoh">'+zbscrm_JS_invoice_lang("hours")+"</th>",e+='<th class="cen" id="zbs_inv_por">'+zbscrm_JS_invoice_lang("rate")+"</th>");1==i.invoiceObj.settings.invtax&&(e+='<th class="cen taxhide">'+zbscrm_JS_invoice_lang("tax")+"</th>");if(e+="<th>"+zbscrm_JS_invoice_lang("amount")+"</th>",e+="</thead>",e+='<tbody class="zbs-invoice-line-items">',rowhtml="",""==i.invoiceObj.invoice_items){n=1;const e={title:"",desc:"",quantity:1,price:0,rate:0};rowhtml+=zbscrm_JS_generate_invoice_row(i,n,e)}else jQuery.each(i.invoiceObj.invoice_items,(function(e,t){rowhtml+=zbscrm_JS_generate_invoice_row(i,window.zbs_invoice_rownum,t)}));return e+=rowhtml,e+="</tbody>",e+="</table>",e+='<div id="zbs-add-new-row"><i class="plus circle icon"></i>'+zbscrm_JS_invoice_lang("add_row")+"</div>",e+="</div>",e}(window.zbs_invoice),i+=function(i){let e="";e+='<div class="invoice-grand-total-wrapper ui grid">',e+='<div class="col-md-6 eight wide column"></div>',e+='<div class="col-md-6 inv-totals eight wide column">',e+='<div class="total-row">',e+='<div class="zlabel half">'+zbscrm_JS_invoice_lang("subtotal")+"</div>",e+='<div class="calc-value half ri" id="subtotal-value"></div>',e+="</div>",1==i.invoiceObj.settings.invdis&&(e+='<div class="total-row">',e+='<div class="zlabel one-four">'+zbscrm_JS_invoice_lang("discount")+"</div>",e+="<div class='two-four invoice-discount-total'>",e+='<input class = "form-control half" type="number" name="invoice_discount_total" id="invoice_discount_total" step="0.01" min="0" value="'+i.invoiceObj.totals.invoice_discount_total+'">',"m"==i.invoiceObj.totals.invoice_discount_type?e+='<select id="invoice_discount_type" name="invoice_discount_type" class="form-control half"><option value="%" >%</option><option value="m" selected>'+zbscrm_JS_invoice_lang("amount")+"</option></select>":e+='<select id="invoice_discount_type" name="invoice_discount_type" class="form-control half"><option value="%">%</option><option value="m">'+zbscrm_JS_invoice_lang("amount")+"</option></select>",e+="</div>",e+='<div id="discount-value" class = "one-four ri">0</div>',e+="</div>");1==i.invoiceObj.settings.invpandp&&(e+='<div class="total-row pbot30">',e+='<div class="zlabel half">'+zbscrm_JS_invoice_lang("shipping")+"</div>",e+='<input class="zbs_gt zbsli_price-1 half ri topmm5" type="number" step="0.01" min="0" name="invoice_postage_total" id="invoice_postage_total" value="'+i.invoiceObj.totals.invoice_postage_total+'">',e+="</div>");shipping=i.invoiceObj.totals,shipping.taxes=i.invoiceObj.shipping_taxes,1==i.invoiceObj.settings.invpandp&&1==i.invoiceObj.settings.invtax&&(e+='<div class="total-row pbot30">',e+='<div class="zlabel half">'+zbscrm_JS_invoice_lang("tax_on_shipping")+"</div>",e+='<div class="half ri topmm10">'+zbscrm_JS_output_tax_line(i,-1,shipping)+"</div>",e+="</div>");return e+='<div class="total-row-wrap" id="tax-total-block">',e+="</div>",e+='<div class="total-row grand-total">',e+='<div class="zlabel half">'+zbscrm_JS_invoice_lang("total")+"</div>",e+='<div class="calc-value half ri zbs-heavy" id="zbs-inv-grand-total"></div>',e+='<input type="hidden" name="zbs-inv-grand-total-store" id="zbs-inv-grand-total-store" value="0" />',e+="</div>",e+="</div>",e+="</div>",e}(window.zbs_invoice),i+=function(i){let e='<div id="zbs-invoice-partial-payments" class = "ui grid">';e+='<div class="col-md-6 eight wide column"></div>';e+='<div class="col-md-6 eight wide column">',window.invoice_partial=!1,jQuery.each(i.invoiceObj.partials,(function(i,t){let n="";0==i&&(e+='<div class="partial-row-tab">'+zbscrm_JS_invoice_lang("partial_table")+"</div>"),e+='<div class="partial-row">';let o="",a="";void 0!==t.type&&void 0!==t.type_accounting&&"credit"==t.type_accounting&&(o=" ("+t.type+")");let s="",c="";void 0!==t.type_accounting&&"credit"==t.type_accounting&&(s="(",c=")");let l=t.total;n=s+t.total+c;let r=zbscrm_JS_invoice_lang("incomplete","Incomplete");void 0!==t.status&&(r=t.status),void 0!==t.status_bool&&1!=t.status_bool&&(a+="<br />("+n+" - "+r+")",n="0.0",l="0.0");const _=function(i){if(zbscrm_JS_DAL()>2)return zeroBSCRMJS_obj_editLink("transaction",i);return zbs_admin_url=window.zbs_links.admin_url,zbs_transaction_link=zbs_admin_url+"post.php?action=edit&post="+i,zbs_transaction_link}(t.id);e+='<div class="zlabel half"><a href="'+_+'" target="_blank">'+t.ref+o+"</a>"+a+"</div>",e+='<div class="zbs-partial-value half ri">'+parseFloat(l).toFixed(zbs_root.currencyOptions.noOfDecimals)+"</div>",e+="</div>",window.invoice_partial=!0})),window.invoice_partial&&(e+='<div id="amount-due" class="due-row">',e+='<div class="amt-due-label zlabel half">'+zbscrm_JS_invoice_lang("amount_due")+"</div>",e+='<div class="amt-due-amt half ri" id="inv-amount-due"></div>',e+="</div>");return e+="</div>",e+="</div>",e}(window.zbs_invoice),jQuery(".zbs_invoice_html_canvas").html(i),setTimeout((function(){jQuery("#zbs-invoice-custom-fields-holder table tr").appendTo(".zbs-invoice-topper table"),zbscrm_JS_bind_row_actions(),jQuery("#invoice-customiser-type").on("change",(function(){"hours"==jQuery(this).val()?(jQuery("#zbs_inv_qoh").html("Hours"),jQuery("#zbs_inv_por").html("Rate")):(jQuery("#zbs_inv_qoh").html("Quantity"),jQuery("#zbs_inv_por").html("Price"))})),jQuery("#invoice_postage_total").on("change",(function(){jQuery("#pandptotal").html(window.zbs_root.currencyOptions.currencyStr+parseFloat(jQuery(this).val()).toFixed(zbs_root.currencyOptions.noOfDecimals)),zbscrm_JS_calcTotals()})),jQuery("#invoice_discount_total, #invoice_discount_type").on("change",(function(){zbscrm_JS_calcTotals()})),jQuery("#invoice_postage_tax").on("keyup mouseup",(function(){""!=jQuery(this).val()&&zbscrm_JS_calcTotals()})),jQuery(".zbs-add-memo-trigger").off("click").on("click",(function(i){jQuery(".zbs-memo-box").show(),jQuery(".zbs-add-memo-trigger").hide()})),jQuery(".zbs-memo-hide").off("click").on("click",(function(i){jQuery(".zbs-memo-box").hide(),jQuery(".zbs-add-memo-trigger").show()})),jQuery(".wh-logo-set .zbs-remove").off("click").on("click",(function(i){jQuery("#wh-logo-set-img").attr("src","").hide(),jQuery("#zbs_invoice_logo").val(""),jQuery(".wh-logo").removeClass("hide").show(),jQuery(".wh-logo-set").hide()})),jQuery(".business-info-toggle").off("click").on("click",(function(i){i.preventDefault(),jQuery(".business-info-toggle i").hasClass("fa-chevron-circle-right")?(jQuery(".business-info-toggle i").removeClass("fa-chevron-circle-right").addClass("fa-chevron-circle-down"),jQuery(".business-info").show()):(jQuery(".business-info-toggle i").removeClass("fa-chevron-circle-down").addClass("fa-chevron-circle-right"),jQuery(".business-info").hide())})),jQuery(".wh-logo, .wh-logo-set .zbs-update").off("click").on("click",(function(i){let e;i.preventDefault(),formlabel=jQuery(this).parent(),e||(e=wp.media.frames.zbs_media_frame=wp.media({className:"media-frame zbs-media-frame",frame:"select",multiple:!1,library:{type:"image"}}),e.on("select",(function(){const i=e.state().get("selection").first().toJSON();jQuery("#logo").val(i.url),jQuery("#wh-logo-set-img").attr("src",i.url).show(),jQuery(".wh-logo-set").show(),jQuery(".wh-logo").hide()}))),e.open()})),jQuery("#zbs_invoicing_download_pdf").off("click").on("click",(function(i){i.preventDefault(),jQuery("#zbs_invoicing_download_pdf_form").submit()})),void 0!==window.zbs_invoice&&void 0!==window.zbs_invoice.invoiceObj&&void 0!==window.zbs_invoice.invoiceObj.due&&jQuery("#zbsinv_due_days").val(window.zbs_invoice.invoiceObj.due),zbscrm_JS_bindDateRangePicker(),function(){endpoint=wpApiSettings.root+"zbscrm/v1/concom?_wpnonce="+wpApiSettings.nonce;var i=new Bloodhound({datumTokenizer:function(i){return Bloodhound.tokenizers.whitespace(i.name_email)},queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:endpoint,ttl:3e5,ajax:{type:"POST",cache:!1,data:{id:-1,obj_type:-1},complete:function(e,t){i.clearRemoteCache()}}},remote:{url:wpApiSettings.root+"zbscrm/v1/concom?_wpnonce="+wpApiSettings.nonce+"&s=%QUERY",wildcard:"%QUERY"}});const select=function(i,e,t){if(jQuery("#zbs_invoicing_send_email").hide(),void 0!==e.id&&null!==e.id&&""!==e.id){const i=zbscrmJS_retrieveCurrentBillToEmail();void 0!==i&&""!=i&&zbscrm_JS_validateEmail(i)&&jQuery("#zbs_invoicing_send_email").show()}1==e.obj_type?(jQuery("#zbs_invoice_contact").val(e.id),jQuery("#zbs_invoice_company").val(-1),zeroBSCRMJS_showContactLinkIf(e.id),zeroBSCRMJS_showCompanyLinkIf(-1)):2==e.obj_type&&(jQuery("#zbs_invoice_company").val(e.id),jQuery("#zbs_invoice_contact").val(-1),zeroBSCRMJS_showContactLinkIf(-1),zeroBSCRMJS_showCompanyLinkIf(e.id))},change=function(i,e,t){if(jQuery("#zbs_invoicing_send_email").hide(),void 0!==e.id&&null!==e.id&&""!==e.id){const i=zbscrmJS_retrieveCurrentBillToEmail();void 0!==i&&""!=i&&zbscrm_JS_validateEmail(i)&&jQuery("#zbs_invoicing_send_email").show()}else""==jQuery("#zbs_inv_bill").val()&&(jQuery("#zbs_invoice_contact").val(-1),jQuery("#zbs_invoice_company").val(-1),zeroBSCRMJS_showContactLinkIf(-1),zeroBSCRMJS_showCompanyLinkIf(-1))};i.initialize(),jQuery("#billing-to .typeahead").typeahead({minLength:1,highlight:!0,hint:!0},{name:"customers_and_companies",displayKey:"name_email",display:function(i){return i.name.trim()?i.name:i.email?i.email:"Contact #"+i.id},source:i.ttAdapter(),limit:10,templates:{suggestion:function(i){ico=2==i.obj_type?'<i class="building icon"></i>':'<i class="user icon"></i>';const e=i.name.trim()?i.name:zeroBSCRMJS_globViewLang("contact")+" #"+i.id,t=i.email?i.email:"<i>"+zbscrm_JS_invoice_lang("noemail")+"</i>";return sug='<div class="sug-wrap"><div class="ico">'+ico+'</div><div class="inner"><div class="name">'+e+'</div><div class="email">'+t+'</div></div><div class="clear"</div></div>',sug},empty:function(i){let e='<a href="'+window.zbs_invoice.invoiceObj.settings.addnewcontacturl+'" target="_blank">'+zbscrm_JS_invoice_lang("addnewcontact")+"</a>";return window.zbs_invoice.invoiceObj.settings.b2bmode&&(e+=" "+zbscrm_JS_invoice_lang("or")+" ",e+='<a href="'+window.zbs_invoice.invoiceObj.settings.addnewcompanyurl+'" target="_blank">'+zbscrm_JS_invoice_lang("newcompany")+"</a>"),'<div class="zbs-add-new-js-assign-to"><i class="address book icon"></i>  '+e+"</div>"}}}).on("typeahead:selected",select).on("typeahead:change",change),setTimeout((function(){const i=(new Date).getTime();if(void 0===(e=jQuery("#billing-to .typeahead").attr("data-autokey")))var e="-typeahead";const t="zbsobj-"+i+"-"+e;jQuery("#billing-to .typeahead").attr("autocomplete",t).attr("name",t)}),0),jQuery(this).on("typeahead:open",(function(i,e){const t=(new Date).getTime();if(void 0===(n=jQuery("#billing-to .typeahead").attr("data-autokey")))var n="-typeahead";const o="zbsobj-"+t+"-"+n;jQuery("#billing-to .typeahead").attr("autocomplete",o).attr("name",o)}))}(),function(){if(void 0!==window.zbs_invoice.invoiceObj&&void 0!==window.zbs_invoice.invoiceObj.invoice_contact&&"0"!=window.zbs_invoice.invoiceObj.invoice_contact&&"-1"!=window.zbs_invoice.invoiceObj.invoice_contact){const i=parseInt(window.zbs_invoice.invoiceObj.invoice_contact);i>0&&zeroBSCRMJS_showContactLinkIf(i)}if(void 0!==window.zbs_invoice.invoiceObj&&void 0!==window.zbs_invoice.invoiceObj.invoice_company&&"0"!=window.zbs_invoice.invoiceObj.invoice_company&&"-1"!=window.zbs_invoice.invoiceObj.invoice_company){const i=parseInt(window.zbs_invoice.invoiceObj.invoice_company);i>0&&zeroBSCRMJS_showCompanyLinkIf(i)}}(),jQuery(".zbs-invoice-row").each((function(i,e){jQuery(e).children().find("input[type=number]").each((function(i,e){zbs_row_to_up=jQuery(this).data("zbsr"),jQuery(this).hasClass("quan")&&(quan=jQuery(this).val()),jQuery(this).hasClass("price")&&(price=jQuery(this).val())})),row_tot=quan*price,jQuery(".row-amount-"+zbs_row_to_up).html(row_tot.toFixed(zbs_root.currencyOptions.noOfDecimals)),zbscrm_JS_calculate_invoice_subtotal()})),zbscrm_JS_calcTotals(),jQuery("#zbs_invoicing_send_email").off("click").on("click",(function(i,e){!function(){let i="";const e=zbscrmJS_retrieveCurrentBillToEmail();if(void 0!==e&&""!=e&&zbscrm_JS_validateEmail(e)&&(i=e),void 0!==i&&""!=i&&zbscrm_JS_validateEmail(i)){let e='<div id="zbs_invoice_email_modal_opts">';if(e+='<div class="zbs-invoice-email-modal-field">',e+='<label for="zbs_invoice_email_modal_toemail">'+zbscrm_JS_invoice_lang("toemail")+"</label>",e+='<input type="email" id="zbs_invoice_email_modal_toemail" value="'+i+'" placeholder="'+zbscrm_JS_invoice_lang("toemailplaceholder")+'" />',e+="</div>",jQuery(".zbsFileLine").length>0){e+='<div class="zbs-invoice-email-modal-field">';var t="";jQuery("#zbsc_sendattachments").is(":checked")&&(t='checked="checked" '),e+='<input type="checkbox" id="zbs_invoice_email_modal_attachassoc" value="1" '+t+"/>",e+='<label for="zbs_invoice_email_modal_attachassoc">'+zbscrm_JS_invoice_lang("attachassoc")+"</label>",e+="</div>"}e+='<div class="zbs-invoice-email-modal-field">',e+='<input type="checkbox" id="zbs_invoice_email_modal_attachaspdf" value="1" '+(t='checked="checked" ')+"/>",e+='<label for="zbs_invoice_email_modal_attachaspdf">'+zbscrm_JS_invoice_lang("attachpdf")+"</label>",e+="</div>",e+="</div>",swal({title:zbscrm_JS_invoice_lang("send_email"),html:'<div class="ui segment">'+zbscrm_JS_invoice_lang("sendthisemail")+e+"</div>",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:zbscrm_JS_invoice_lang("sendthemail")}).then((function(i){if(i.value){const i=jQuery("#zbs_invoice_email_modal_toemail").val();if(void 0!==i&&""!=i&&zbscrm_JS_validateEmail(i)&&window.invoice_id>0){let e=-1;jQuery("#zbs_invoice_email_modal_attachassoc").length>0&&jQuery("#zbs_invoice_email_modal_attachassoc").is(":checked")&&(e=1);let t=-1;jQuery("#zbs_invoice_email_modal_attachaspdf").length>0&&jQuery("#zbs_invoice_email_modal_attachaspdf").is(":checked")&&(t=1);const n={id:window.invoice_id,email:i,attachassoc:e,attachpdf:t};swal.fire({title:zbscrm_JS_invoice_lang("sendingemail"),html:'<div style="clear:both">&nbsp;</div><div class="ui active loader" style="margin-top:2em;padding-bottom:2em"></div><div style="clear:both">&nbsp;</div>',showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1}),function(i){window.zbsInvBlocker||(window.zbsInvBlocker=!0,void 0!==i.id&&i.id>0&&void 0!==i.email&&zbscrm_JS_validateEmail(i.email)&&(i.action="zbs_invoice_send_invoice",i.security=jQuery("#inv-ajax-nonce").val(),jQuery.ajax({url:ajaxurl,type:"POST",data:i,dataType:"json",success:function(i){swal(zbscrm_JS_invoice_lang("senttitle"),zbscrm_JS_invoice_lang("sent"),"info"),window.zbsInvBlocker=!1},error:function(i){console.error("senderr",i),swal(zbscrm_JS_invoice_lang("senderrortitle")+" #19v3",zbscrm_JS_invoice_lang("senderror"),"error"),window.zbsInvBlocker=!1}})))}(n)}else swal.fire(zbscrm_JS_invoice_lang("sendneedsassignment"))}}))}else swal.fire(zbscrm_JS_invoice_lang("sendneedsassignment"))}()})),jQuery("#zbs_loader").hide()}),0)}else jQuery("#zbsCantLoadDataSingle").show(),jQuery("#zbs-edit-wrap, #zbs-screen-options").hide(),jQuery("#zbs_loader, #zbs_invoice").hide()}()},error:function(i){jQuery("#zbsCantLoadDataSingle").show(),jQuery("#zbs-edit-wrap, #zbs-screen-options").hide(),jQuery("#zbs_loader, #zbs_invoice").hide()}})}(invoice_id),jQuery("#invoice_tax_total").val()>0&&jQuery("#invoice_totals .tax_total").show()}));var t=window="undefined"==typeof window?{}:window;for(var n in i)t[n]=i[n];i.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})})();