/*! For license information please see jpcrm-mailpoet-add-edit-page.min.js.LICENSE.txt */
(()=>{var e={624:e=>{function jpcrm_mailpoet_initiate_export(e){if(!window.zbsAJAXSending){window.zbsAJAXSending=!0;var t=[];jQuery(".zbs-segment-edit-condition").each((function(e,r){var o=jQuery(".zbs-segment-edit-var-condition-type",jQuery(r)).val(),i=jQuery(".zbs-segment-edit-var-condition-operator",jQuery(r)).val();void 0!==i&&"undefined"!=i||(i=-1);var n={type:o,operator:i,value:jQuery(".zbs-segment-edit-var-condition-value",jQuery(r)).val(),value2:jQuery(".zbs-segment-edit-var-condition-value-2",jQuery(r)).val()};t.push(n)}));var r=jQuery("#zbs-segment-edit-var-title").val(),o=jQuery("#zbs-segment-edit-var-matchtype").val(),i={id:window.zbsSegment.id,title:r,matchtype:o,conditions:t};e.addClass("loading"),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_export_kick_off",segment_id:i.id,sec:window.zbsSegmentSEC},timeout:3e4,success:function(t){return e.removeClass("loading"),1==t.success&&t.mailpoet_list_ID?(swal.fire({title:t.lang.export_in_progress,html:`<div id="jpcrm_segment_mailpoet_modal" style="clear:both" data-complete-title="${t.lang.export_finished}">\n                            <p class="jpcrm-export-success">${t.lang.export_in_progress_long}</p>\n                            <p class="jpcrm-export-progress"></p>\n                            <p style="display:none" class="jpcrm-export-complete">${t.lang.export_finished_long}</p>\n                            <a style="display:none" class="jpcrm-export-goto-mailpoet ui button small basic" href="/wp-admin/admin.php?page=mailpoet-subscribers#/filter[segment=${t.mailpoet_list_ID}]">${t.lang.go_to_mailpoet_list}</a>\n                            </div>`,showConfirmButton:!1,showCancelButton:!0,allowOutsideClick:!1}),window.jpcrm_mailpoet_cancel_exporting=!1,jQuery(".swal2-cancel").off("click").on("click",(()=>{window.jpcrm_mailpoet_cancel_exporting=!0})),jpcrm_segment_batch_export({mailpoet_id:t.mailpoet_list_ID,segment_id:t.jpcrm_segment_ID,page:0,total:t.total_contacts})):swal.fire({title:t.lang.error_title,html:'<div style="clear:both"></div>',showConfirmButton:!1}),window.zbsAJAXSending=!1,"function"==typeof callback&&callback(t),!0},error:function(t,r){swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error"),e.removeClass("loading"),window.zbsAJAXSending=!1,console.log("error",t)}})}}function jpcrm_segment_batch_export(e){const{mailpoet_id:t,segment_id:r,page:o,total:i}=e,n=100,a=Math.ceil(i/n);window.jpcrm_mailpoet_export_fail_count||(window.jpcrm_mailpoet_export_fail_count=0);let l=i;i>n&&(l=o<a?n*(o||1):i),jQuery(".jpcrm-export-progress").html(`\n        <div class="jpcrm-export-progress-counter"><span>${l}</span> / ${i}</div>\n        <div class="jpcrm-export-progress-bar" style="width:${Math.floor(100*l/i)}%"></div>\n    `),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_export_segment",mailpoet_id:t,segment_id:r,page:o,per_page:n},timeout:3e4,success:function(e){if(!0!==window.jpcrm_mailpoet_cancel_exporting)if(e.is_last_batch){jQuery(".jpcrm-export-progress").hide(),jQuery(".swal2-cancel").hide(),jQuery(".jpcrm-export-success").hide();var o=jQuery("#jpcrm_segment_mailpoet_modal").attr("data-complete-title");jQuery(".swal2-title").text(o),jQuery(".jpcrm-export-complete").show(),jQuery(".jpcrm-export-goto-mailpoet").show()}else jpcrm_segment_batch_export({mailpoet_id:t,segment_id:r,page:e.current_page+1,total:i})},error:function(e){if(window.jpcrm_mailpoet_export_fail_count++,!(window.jpcrm_mailpoet_export_fail_count<10))return console.log("Export to MailPoet Error",e),swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error"),window.zbsAJAXSending=!1,!1;jpcrm_segment_batch_export({mailpoet_id:t,segment_id:r,page:o,total:i})}})}function jpcrm_mailpoet_retrieve_list_summary(e,t,r){jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"jpcrm_mailpoet_retrieve_list_summary",list_name:e,add_suffix:1},timeout:3e4,success:function(e){return"function"==typeof t&&t(e),e},error:function(e){return console.log("MailPoet summary retrieve error",e),swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("generalerror"),"error"),"function"==typeof r&&r(),!1}})}e.exports={jpcrm_segment_export_to_mailpoet:function(e){if(window.zbsSegment.id){var t=jQuery("#zbs-segment-edit-var-title").val();e.addClass("loading"),jpcrm_mailpoet_retrieve_list_summary(t,(function(t){e.removeClass("loading"),t&&t.id?swal.fire({title:zeroBSCRMJS_segmentLang("mailpoet_list_exists"),html:"<p>"+zeroBSCRMJS_segmentLang("mailpoet_list_exists_detail")+"</p>",showCancelButton:!0,confirmButtonText:zeroBSCRMJS_segmentLang("continue_export"),cancelButtonText:zeroBSCRMJS_segmentLang("cancel")}).then((t=>{t.value&&jpcrm_mailpoet_initiate_export(e)})):jpcrm_mailpoet_initiate_export(e)}),(function(){e.removeClass("loading")}))}else swal(zeroBSCRMJS_segmentLang("generalerrortitle"),zeroBSCRMJS_segmentLang("nosegmentid"),"error")},jpcrm_mailpoet_initiate_export:jpcrm_mailpoet_initiate_export,jpcrm_segment_batch_export:jpcrm_segment_batch_export,jpcrm_mailpoet_retrieve_list_summary:jpcrm_mailpoet_retrieve_list_summary}}},t={};var r=function __webpack_require__(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,__webpack_require__),i.exports}(624),o=window="undefined"==typeof window?{}:window;for(var i in r)o[i]=r[i];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();